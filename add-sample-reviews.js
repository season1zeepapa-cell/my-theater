// ====================================
// ìƒ˜í”Œ ë¦¬ë·° ì¶”ê°€ ìŠ¤í¬ë¦½íŠ¸
// ====================================
// ê¸°ì¡´ ìƒ˜í”Œ ë°ì´í„°(ì˜í™” 5ê°œ, ì±… 5ê°œ)ì— ë¦¬ë·°ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
// ì‹¤í–‰ í›„ "ë‚´ê°€ ë³¸ ì˜í™”"ì™€ "ë‚´ê°€ ì½ì€ ì±…" ì„¹ì…˜ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

// í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
require('dotenv').config();

// í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
const { Pool } = require('pg');

// ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„¤ì •
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: {
    rejectUnauthorized: false
  }
});

// ====================================
// ìƒ˜í”Œ ë¦¬ë·° ë°ì´í„°
// ====================================

// ì˜í™” ë¦¬ë·° ë°ì´í„° (ì œëª©ë³„ë¡œ ë§¤ì¹­)
const movieReviews = {
  'ì¸í„°ìŠ¤í…”ë¼': {
    rating: 5,
    one_liner: 'ìš°ì£¼ SFì˜ ëª…ì‘! ì‹œê°„ê³¼ ê³µê°„ì„ ì´ˆì›”í•œ ê°ë™',
    detailed_review: 'í¬ë¦¬ìŠ¤í† í¼ ë†€ë€ ê°ë…ì˜ ìµœê³  ê±¸ì‘. ìƒëŒ€ì„± ì´ë¡ ê³¼ ë¸”ë™í™€ì„ ë‹¤ë£¨ë©´ì„œë„ ë¶€ë…€ê°„ì˜ ì‚¬ë‘ì„ ì¤‘ì‹¬ìœ¼ë¡œ í’€ì–´ë‚¸ ì´ì•¼ê¸°ê°€ ê°ë™ì ì…ë‹ˆë‹¤. í•œìŠ¤ ì§ë¨¸ì˜ OSTëŠ” ì •ë§ ì••ë„ì ì´ì—ìš”.'
  },
  'ì¸ì…‰ì…˜': {
    rating: 5,
    one_liner: 'ê¿ˆì†ì˜ ê¿ˆ, ë†€ë€ì˜ ì²œì¬ì„±ì´ ë¹›ë‚˜ëŠ” ì‘í’ˆ',
    detailed_review: 'í˜„ì‹¤ê³¼ ê¿ˆì˜ ê²½ê³„ë¥¼ ë„˜ë‚˜ë“œëŠ” ì„¤ì •ì´ ë„ˆë¬´ ì°½ì˜ì ì…ë‹ˆë‹¤. íŒ½ì´ê°€ ëŒì•„ê°€ëŠ” ë§ˆì§€ë§‰ ì¥ë©´ì€ ì•„ì§ë„ ìƒê°í•˜ê²Œ ë§Œë“œë„¤ìš”. ì—¬ëŸ¬ ë²ˆ ë´ë„ ìƒˆë¡œìš´ í•´ì„ì´ ë‚˜ì™€ìš”.'
  },
  'ê¸°ìƒì¶©': {
    rating: 5,
    one_liner: 'í•œêµ­ ì˜í™”ì˜ ìë‘, ì•„ì¹´ë°ë¯¸ ì‘í’ˆìƒ ìˆ˜ìƒì‘',
    detailed_review: 'ë¹ˆë¶€ê²©ì°¨ë¥¼ ì´ë ‡ê²Œ ì¬ë¯¸ìˆê³  ë‚ ì¹´ë¡­ê²Œ í’€ì–´ë‚¸ ì‘í’ˆì€ ì²˜ìŒì…ë‹ˆë‹¤. ì†¡ê°•í˜¸ ë°°ìš°ë¥¼ ë¹„ë¡¯í•œ ëª¨ë“  ì—°ê¸°ê°€ ì™„ë²½í•˜ê³ , ë´‰ì¤€í˜¸ ê°ë…ì˜ ì—°ì¶œë ¥ì´ ë‹ë³´ì…ë‹ˆë‹¤.'
  },
  'ì–´ë²¤ì ¸ìŠ¤: ì—”ë“œê²Œì„': {
    rating: 4,
    one_liner: 'MCU 10ë…„ì˜ ëŒ€ì¥ì •ì„ ë§ˆë¬´ë¦¬í•˜ëŠ” ì™„ë²½í•œ í”¼ë‚ ë ˆ',
    detailed_review: 'ì•„ì´ì–¸ë§¨ì˜ ë§ˆì§€ë§‰ì´ ë„ˆë¬´ ê°ë™ì ì´ì—ˆì–´ìš”. 3ì‹œê°„ì´ ì „í˜€ ì§€ë£¨í•˜ì§€ ì•Šì•˜ê³ , ëª¨ë“  íˆì–´ë¡œë“¤ì´ ëª¨ì´ëŠ” ì¥ë©´ì—ì„œ ì†Œë¦„ì´ ë‹ì•˜ìŠµë‹ˆë‹¤. íŒ¬ì´ë¼ë©´ ê¼­ ë´ì•¼ í•  ì‘í’ˆ!'
  },
  'ì¡°ì»¤': {
    rating: 5,
    one_liner: 'í˜¸ì•„í‚¨ í”¼ë‹‰ìŠ¤ì˜ ì—°ê¸°ì— ì••ë„ë‹¹í•œ ì˜í™”',
    detailed_review: 'ë¹ŒëŸ°ì˜ íƒ„ìƒì„ ì´ë ‡ê²Œ ì„¬ì„¸í•˜ê²Œ ê·¸ë ¤ë‚¸ ì‘í’ˆì€ ì—†ì—ˆìŠµë‹ˆë‹¤. ì‚¬íšŒì˜ ëƒ‰ë‹´í•¨ê³¼ ê°œì¸ì˜ ê´‘ê¸°ê°€ ë§Œë‚˜ëŠ” ì§€ì ì„ ì™„ë²½í•˜ê²Œ í‘œí˜„í–ˆì–´ìš”. ë¬´ê±°ìš´ ì£¼ì œì§€ë§Œ ê¼­ ë´ì•¼ í•  ëª…ì‘ì…ë‹ˆë‹¤.'
  }
};

// ì±… ë¦¬ë·° ë°ì´í„° (ì œëª©ë³„ë¡œ ë§¤ì¹­)
const bookReviews = {
  'ì‚¬í”¼ì—”ìŠ¤': {
    rating: 5,
    one_liner: 'ì¸ë¥˜ì˜ ì—­ì‚¬ë¥¼ ìƒˆë¡­ê²Œ ë°”ë¼ë³´ê²Œ ë§Œë“  ì±…',
    detailed_review: 'í˜¸ëª¨ ì‚¬í”¼ì—”ìŠ¤ê°€ ì–´ë–»ê²Œ ì§€êµ¬ë¥¼ ì •ë³µí–ˆëŠ”ì§€ë¥¼ í¥ë¯¸ì§„ì§„í•˜ê²Œ í’€ì–´ëƒˆìŠµë‹ˆë‹¤. ì¸ì§€í˜ëª…, ë†ì—…í˜ëª…, ê³¼í•™í˜ëª…ì„ ê±°ì¹˜ë©° ì¸ë¥˜ê°€ ì–´ë–»ê²Œ ë°œì „í–ˆëŠ”ì§€ ì´í•´í•˜ëŠ” ë° í° ë„ì›€ì´ ëì–´ìš”.'
  },
  'ì´, ê· , ì‡ ': {
    rating: 4,
    one_liner: 'ì™œ ì–´ë–¤ ë¬¸ëª…ì€ ë°œì „í•˜ê³  ì–´ë–¤ ë¬¸ëª…ì€ ì‚¬ë¼ì¡ŒëŠ”ê°€',
    detailed_review: 'ì§€ë¦¬ì  í™˜ê²½ì´ ë¬¸ëª…ì˜ ë°œì „ì„ ì–´ë–»ê²Œ ê²°ì •í–ˆëŠ”ì§€ ì„¤ë“ë ¥ ìˆê²Œ ì„¤ëª…í•©ë‹ˆë‹¤. ë‹¤ì†Œ ì–´ë ¤ìš´ ë¶€ë¶„ë„ ìˆì§€ë§Œ ì¸ë¥˜ ì—­ì‚¬ë¥¼ ì´í•´í•˜ëŠ” ìƒˆë¡œìš´ ì‹œê°ì„ ì œê³µí•´ì¤˜ìš”.'
  },
  'ì½”ìŠ¤ëª¨ìŠ¤': {
    rating: 5,
    one_liner: 'ìš°ì£¼ì˜ ì‹ ë¹„ë¥¼ ì‰½ê³  ì•„ë¦„ë‹µê²Œ í’€ì–´ë‚¸ ê³¼í•™ì„œ',
    detailed_review: 'ì¹¼ ì„¸ì´ê±´ì˜ ë¬¸í•™ì  ê°ì„±ê³¼ ê³¼í•™ì  í†µì°°ì´ ê²°í•©ëœ ìµœê³ ì˜ ê³¼í•™ êµì–‘ì„œì…ë‹ˆë‹¤. ìš°ì£¼ì˜ ê´‘ëŒ€í•¨ ì•ì—ì„œ ê²¸ì†í•´ì§€ê³ , ë™ì‹œì— ì¸ê°„ì˜ íƒêµ¬ì •ì‹ ì— ê°ë™í•˜ê²Œ ë©ë‹ˆë‹¤.'
  },
  'ì´ê¸°ì ì¸ ìœ ì „ìë€ ë¬´ì—‡ì¸ê°€': {
    rating: 4,
    one_liner: 'ìœ ì „ì ê´€ì ì—ì„œ ë³¸ ìƒëª…ì˜ ì§„í™”, ëˆˆì´ ë²ˆì© ëœ¨ì„',
    detailed_review: 'ë¦¬ì²˜ë“œ ë„í‚¨ìŠ¤ì˜ í†µì°°ì´ ë‹´ê¸´ ëª…ì €ì…ë‹ˆë‹¤. ìœ ì „ìê°€ ìƒì¡´ê¸°ê³„ë¥¼ ë§Œë“¤ì–´ë‚¸ë‹¤ëŠ” ê´€ì ì´ ì²˜ìŒì—” ë‚¯ì„¤ì—ˆì§€ë§Œ, ì½ë‹¤ ë³´ë‹ˆ ì§„í™”ë¥¼ ì´í•´í•˜ëŠ” ìƒˆë¡œìš´ ë Œì¦ˆë¥¼ ì–»ì—ˆì–´ìš”.'
  },
  'ì§€ì  ëŒ€í™”ë¥¼ ìœ„í•œ ë„“ê³  ì–•ì€ ì§€ì‹': {
    rating: 4,
    one_liner: 'êµì–‘ì˜ ê¸°ì´ˆë¥¼ ë‹¤ì§€ê¸° ì¢‹ì€ ì…ë¬¸ì„œ',
    detailed_review: 'ì—­ì‚¬, ê²½ì œ, ì •ì¹˜, ì‚¬íšŒ, ìœ¤ë¦¬ë¥¼ í•œ ê¶Œìœ¼ë¡œ ì •ë¦¬í•´ì£¼ëŠ” ì±…ì…ë‹ˆë‹¤. ê¹Šì´ëŠ” ë¶€ì¡±í•˜ì§€ë§Œ ì „ë°˜ì ì¸ íë¦„ì„ ì´í•´í•˜ê³  ëŒ€í™”ì˜ ì†Œì¬ë¥¼ ì–»ê¸°ì— ì¢‹ì•„ìš”. ì‹œë¦¬ì¦ˆë¡œ ì½ìœ¼ë©´ ë” ì¢‹ìŠµë‹ˆë‹¤.'
  }
};

// ====================================
// ë¦¬ë·° ì¶”ê°€ í•¨ìˆ˜
// ====================================
async function addReview(contentId, reviewData) {
  try {
    const result = await pool.query(
      `INSERT INTO reviews (content_id, rating, one_liner, detailed_review)
       VALUES ($1, $2, $3, $4)
       RETURNING *`,
      [contentId, reviewData.rating, reviewData.one_liner, reviewData.detailed_review]
    );

    return result.rows[0];
  } catch (error) {
    // ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²½ìš° ë¬´ì‹œ
    console.error(`ë¦¬ë·° ì¶”ê°€ ì˜¤ë¥˜:`, error.message);
    return null;
  }
}

// ====================================
// ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜
// ====================================
async function main() {
  console.log('ğŸ¬ ìƒ˜í”Œ ë¦¬ë·° ì¶”ê°€ ì‹œì‘...\n');

  try {
    // 1ë‹¨ê³„: ëª¨ë“  ì½˜í…ì¸  ê°€ì ¸ì˜¤ê¸°
    const contentsResult = await pool.query(
      'SELECT * FROM contents ORDER BY created_at DESC'
    );

    const contents = contentsResult.rows;

    if (contents.length === 0) {
      console.log('âš ï¸  ì•„ì¹´ì´ë¸Œì— ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.');
      console.log('   ë¨¼ì € seed-sample-data.jsë¥¼ ì‹¤í–‰í•˜ì—¬ ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.\n');
      console.log('   ì‹¤í–‰: node seed-sample-data.js\n');
      process.exit(0);
    }

    console.log(`âœ… ${contents.length}ê°œì˜ ì½˜í…ì¸ ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤.\n`);

    // 2ë‹¨ê³„: ì˜í™” ë¦¬ë·° ì¶”ê°€
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('ğŸ¬ ì˜í™” ë¦¬ë·° ì¶”ê°€ ì¤‘...');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');

    let movieReviewCount = 0;

    for (const content of contents) {
      if (content.type === 'movie') {
        // ì œëª©ì— í•´ë‹¹í•˜ëŠ” ë¦¬ë·° ë°ì´í„° ì°¾ê¸°
        for (const [title, reviewData] of Object.entries(movieReviews)) {
          if (content.title.includes(title)) {
            console.log(`ğŸ“ "${content.title}"ì— ë¦¬ë·° ì¶”ê°€ ì¤‘...`);

            const review = await addReview(content.id, reviewData);

            if (review) {
              console.log(`   â­ ë³„ì : ${'â˜…'.repeat(reviewData.rating)}${'â˜†'.repeat(5 - reviewData.rating)} (${reviewData.rating}/5)`);
              console.log(`   ğŸ’¬ í•œì¤„í‰: ${reviewData.one_liner}`);
              console.log(`   âœ… ë¦¬ë·° ì¶”ê°€ ì™„ë£Œ!\n`);
              movieReviewCount++;
            } else {
              console.log(`   â­ï¸  ì´ë¯¸ ë¦¬ë·°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.\n`);
            }

            break;
          }
        }
      }
    }

    // 3ë‹¨ê³„: ì±… ë¦¬ë·° ì¶”ê°€
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('ğŸ“š ì±… ë¦¬ë·° ì¶”ê°€ ì¤‘...');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');

    let bookReviewCount = 0;

    for (const content of contents) {
      if (content.type === 'book') {
        // ì œëª©ì— í•´ë‹¹í•˜ëŠ” ë¦¬ë·° ë°ì´í„° ì°¾ê¸°
        for (const [title, reviewData] of Object.entries(bookReviews)) {
          if (content.title.includes(title)) {
            console.log(`ğŸ“ "${content.title}"ì— ë¦¬ë·° ì¶”ê°€ ì¤‘...`);

            const review = await addReview(content.id, reviewData);

            if (review) {
              console.log(`   â­ ë³„ì : ${'â˜…'.repeat(reviewData.rating)}${'â˜†'.repeat(5 - reviewData.rating)} (${reviewData.rating}/5)`);
              console.log(`   ğŸ’¬ í•œì¤„í‰: ${reviewData.one_liner}`);
              console.log(`   âœ… ë¦¬ë·° ì¶”ê°€ ì™„ë£Œ!\n`);
              bookReviewCount++;
            } else {
              console.log(`   â­ï¸  ì´ë¯¸ ë¦¬ë·°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.\n`);
            }

            break;
          }
        }
      }
    }

    // 4ë‹¨ê³„: ê²°ê³¼ ìš”ì•½
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('âœ¨ ìƒ˜í”Œ ë¦¬ë·° ì¶”ê°€ ì™„ë£Œ!');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');

    console.log(`ğŸ“Š ì¶”ê°€ëœ ë¦¬ë·° ê°œìˆ˜:`);
    console.log(`   ğŸ¬ ì˜í™”: ${movieReviewCount}ê°œ`);
    console.log(`   ğŸ“š ì±…: ${bookReviewCount}ê°œ`);
    console.log(`   ğŸ“ ì´: ${movieReviewCount + bookReviewCount}ê°œ\n`);

    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log('ğŸŒ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸í•˜ê¸°');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n');

    console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3001 ì—´ê¸°');
    console.log('2. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (F5)');
    console.log('3. "ë‚´ê°€ ë³¸ ì˜í™”" ì„¹ì…˜ í™•ì¸ â†’ 5ê°œì˜ ì˜í™” í‘œì‹œë¨');
    console.log('4. "ë‚´ê°€ ì½ì€ ì±…" ì„¹ì…˜ í™•ì¸ â†’ 5ê°œì˜ ì±… í‘œì‹œë¨');
    console.log('5. ì¹´ë“œ í´ë¦­ â†’ ë¦¬ë·° ë‚´ìš© íŒì—…ìœ¼ë¡œ í‘œì‹œ\n');

    console.log('ğŸ’¡ Tip: "ë‚´ ì•„ì¹´ì´ë¸Œ"ëŠ” ì´ì œ ë¹„ì–´ìˆì„ ê±°ì˜ˆìš” (ë¦¬ë·°ê°€ ëª¨ë‘ ì‘ì„±ë˜ì—ˆìœ¼ë¯€ë¡œ)\n');

  } catch (error) {
    console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
  } finally {
    // ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì¢…ë£Œ
    await pool.end();
  }
}

// ====================================
// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
// ====================================
main().catch(error => {
  console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
  process.exit(1);
});
